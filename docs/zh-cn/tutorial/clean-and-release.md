# 清理与发布

本章是教程的最后一张。如果读到这里，那么你差不多已经能够独立完成一张自制地图了，剩下的工作看起来无关紧要，毕竟你的地图已经能玩了。但如果你想做到更好，例如便于后续的更新维护，或者减小地图/工程文件体积等，可以参考本章的内容。

## 合并物体

如果你的路面、钢轨在制作时大量使用了拼接的方法，那么你的工程文件内可能存在着非常多的路面“碎片”。我们可以把一些临近的碎片结合在一起，就能减少物体的数量。

合并物体只需要选中他们然后按下 `Ctrl + J` 即可。

除此以外，由于 Stopper 声音 Bug，推荐把所有的 Stopper 合并在一起，保证地图内至多只有一个 Stopper。这样在游戏内看起来，就可以使所有的 Stopper 都能够发出声音。

合并物体后若需要调整位置等，可以直接在编辑模式下操作。也可以（推荐用 **面** 模式）选中某个部分后，按下 `P` 选择 **选中项** 将其分离。

## 合并顶点

合并物体的另一个好处是能够将重复的顶点合并在一起。合并顶点能够节省大量顶点，这非常有利于节省地图文件的大小。也可以一定程度上减少顶点过多所产生的物理穿模 Bug。

在编辑模式下，按 `1` 切换到顶点模式，按 `A` 全选顶点，然后按 `M` 选择 **按距离**，即可合并该物体的所有重合的顶点。一般情况下我们使用顶点吸附对齐的物体，使用默认的合并阈值就可以全部合并了，如果特殊情况下，看起来靠得很近的顶点却没有被合并，可以手动选中这些顶点，然后提高合并距离。

在合并顶点时一定要记得选上对话框中的 **保持锐边**！这能非常有效地防止[路面发黑问题](../trouble-shooting/black.md)。

## 物体命名整理

保持良好的命名格式有利于后续的维护。以往的流程中，保持物体的命名是比较麻烦的事情，至少相对 Blender 制图是的。借助 BBP，只需要在 **大纲视图** 内，右键我们所有物体所在的集合，（Collection），然后选择 **调整物体名称**，即可一键调整物体命名，非常方便。

名称的调整是根据物体的归组而定的，具体规则可以看 [BBP 的命名规则文档](https://yyc12345.github.io/BallanceBlenderHelper/zh-cn/naming-convention/)。

<!-- TODO: ## 无用物体整理 -->

## 地图测试与发布

我们建议使用 BML/BMLP 测试地图，优势如下：

- 可以 `F1` 飞行。
- 可以快速切换小节。
- 可以自由换球、生成道具。
- 有一个集中存放地图文件的文件夹，不需要手动替换原版关卡。

在发布前，**必须使用非作弊模式自己能够通关至少一次**，以确保地图的可玩性。此外，我们建议借助 BML/BMLP 的作弊模式测试地图的每一个细节，确保路面花纹、纹理贴图、对齐等。

在完成最终的测试后，你可以将地图文件发至社区邀请大家游玩，也可以申请上传至地图下载站。
